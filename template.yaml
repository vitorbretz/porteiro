AWSTemplateFormatVersion: '2010-09-09'
Transform: AWS::Serverless-2016-10-31
Description: >
  porteiro

  Template SAM para iniciar e parar uma instÃ¢ncia EC2 automaticamente.

Globals:
  Function:
    Timeout: 3 # â³ Tempo mÃ¡ximo de execuÃ§Ã£o da funÃ§Ã£o Lambda (em segundos)

Resources:
  # ğŸš€ FunÃ§Ã£o Lambda para ligar a instÃ¢ncia EC2
  LigarPorteiro:
    Type: AWS::Serverless::Function
    Properties:
      Handler: src/handlers/porteiro.startEC2Instance # ğŸ”§ Caminho do handler (altere se mudar a pasta/arquivo)
      Runtime: nodejs22.x # ğŸ”§ Runtime da Lambda (Node.js 22.x)
      Architectures:
        - x86_64
      Events:
        CloudwatchEvent:
          Type: Schedule
          Properties:
            # â° Agendamento em formato CRON
            # â Aqui estÃ¡ configurado para rodar Ã s 07:00 de segunda a sÃ¡bado
            # obs: sempre considera o horÃ¡rio UTC
            
            Schedule: cron(00 10 ? * MON-SAT *)
      Policies:
        - Statement:
            - Sid: StartEC2Instance
              Effect: Allow
              Action:
                - ec2:StartInstances # ğŸ”‘ PermissÃ£o necessÃ¡ria para ligar a EC2
              Resource: "*" # âš ï¸ Coloque o ARN especÃ­fico da instÃ¢ncia se quiser restringir

  # ğŸ“´ FunÃ§Ã£o Lambda para desligar a instÃ¢ncia EC2
  DesligarPorteiro:
    Type: AWS::Serverless::Function
    Properties:
      Handler: src/handlers/porteiro.stopEC2Instance # ğŸ”§ Caminho do handler (altere se mudar a pasta/arquivo)
      Runtime: nodejs22.x
      Architectures:
        - x86_64
      Events:
        CloudwatchEvent:
          Type: Schedule
          Properties:
            # â° Agendamento em formato CRON
            # â Aqui estÃ¡ configurado para parar as 18:00 de segunda a sÃ¡bado
            # obs: sempre considera o horÃ¡rio UTC
            Schedule: cron(00 21 ? * MON-SAT *)
      Policies:
        - Statement:
            - Sid: StopEC2Instance
              Effect: Allow
              Action:
                - ec2:StopInstances # ğŸ”‘ PermissÃ£o necessÃ¡ria para desligar a EC2
              Resource: "*" # âš ï¸ Recomenda-se restringir ao ARN da instÃ¢ncia
